# Dockerfile para desenvolvimento com hot reload
FROM node:18-alpine

# Instalar dependências de sistema
RUN apk add --no-cache \
    python3 \
    py3-pip \
    python3-dev \
    py3-wheel \
    py3-setuptools \
    make \
    g++ \
    gcc \
    musl-dev \
    linux-headers \
    libc6-compat \
    libffi-dev \
    openssl-dev

WORKDIR /app

# Copiar arquivos de dependências
COPY package*.json ./
COPY python_modules/requirements.txt ./python_modules/

# Instalar todas as dependências (incluindo dev)
RUN npm install --no-audit --no-fund

# Remove EXTERNALLY-MANAGED file to allow pip installs in Docker
RUN rm -f /usr/lib/python*/EXTERNALLY-MANAGED

# Atualizar pip e instalar dependências Python
RUN pip3 install --upgrade pip setuptools wheel && \
    pip3 install --no-cache-dir -r python_modules/requirements.txt

# Criar diretórios necessários
RUN mkdir -p uploads logs config

# Expor porta para desenvolvimento
EXPOSE 3000

# Comando para desenvolvimento com hot reload
CMD ["npm", "run", "dev"]